import { describe, it, expect } from 'vitest';
import { TransactionSkeletonType } from '@ckb-lumos/helpers';
import { ckbTxFromTxSkeleton } from './spore';

describe('spore utils', () => {
  it('ckbTxFromTxSkeleton', () => {
    const txSkeleton: TransactionSkeletonType = JSON.parse(
      `{"cellProvider":{"medianTimeEmitters":[],"emitters":[],"isSubscribeRunning":false,"ckbIndexerUrl":"https://testnet.ckb.dev/indexer","ckbRpcUrl":"https://testnet.ckb.dev/rpc","uri":"https://testnet.ckb.dev/rpc","ckbIndexerUri":"https://testnet.ckb.dev/indexer"},"cellDeps":[{"outPoint":{"txHash":"0xcebb174d6e300e26074aea2f5dbd7f694bb4fe3de52b6dfe205e54f90164510a","index":"0x0"},"depType":"code"},{"outPoint":{"txHash":"0xf8de3bb47d055cdf460d93a2a6e1b05f7432f9777c8c474abf4eec1d4aee5d37","index":"0x0"},"depType":"depGroup"}],"headerDeps":[],"inputs":[{"cellOutput":{"capacity":"0x4bfef497b","lock":{"args":"0x8930e1e7f192adb3e3f600bd6ae935609d1f814b","codeHash":"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8","hashType":"type"},"type":null},"data":"0x","outPoint":{"index":"0x0","txHash":"0x05a1031782c7b972e8a168f790c219f224baa2afa9859d75b4d0aaf00f0a6bd2"},"blockNumber":"0xc104aa"},{"cellOutput":{"capacity":"0x1a4d22e11848","lock":{"args":"0x8930e1e7f192adb3e3f600bd6ae935609d1f814b","codeHash":"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8","hashType":"type"},"type":null},"data":"0x","outPoint":{"index":"0x1","txHash":"0x98b9d2e665af8b74ec56e1e7d2a774156e8dbc42d520ee666a9dbf7fda7b4ed6"},"blockNumber":"0xc104ab"}],"outputs":[{"cellOutput":{"capacity":"0x466871d00","lock":{"codeHash":"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8","hashType":"type","args":"0x8930e1e7f192adb3e3f600bd6ae935609d1f814b"},"type":{"codeHash":"0x0bbe768b519d8ea7b96d58f1182eb7e6ef96c541fbd9526975077ee09f049058","hashType":"data1","args":"0x95adcba64ed356367200f5a52d5bfa557c5766c1b7bfbfbdec4ac4afbc05eb97"}},"data":"0x3e00000010000000200000003e0000000c0000005465737420636c75737465721a0000004465736372697074696f6e206f662074686520636c7573746572"},{"cellOutput":{"capacity":"0x1a4d7c4940e6","lock":{"codeHash":"0x9bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce8","hashType":"type","args":"0x8930e1e7f192adb3e3f600bd6ae935609d1f814b"}},"data":"0x"}],"witnesses":["0x55000000100000005500000055000000410000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000","0x","0x010000ff150100000c00000010000000000000000501000008000000fd00000008000000f5000000100000003000000050000000f6d8754e70010043b42fec83065dac4a41b4fb9dca198e2431749fcfd28d2d65867ddd7791e0fe1d83c6bc8bd6cf0df757a28833b1584f3887aa34688e193e7ea1000000030000009d00000010000000300000007d00000095adcba64ed356367200f5a52d5bfa557c5766c1b7bfbfbdec4ac4afbc05eb9700000000490000001000000030000000310000009bd7e06f3ecf4be0f2fcd2188b23f1b9fcc88e5d4b65a8637b17723bbda3cce801140000008930e1e7f192adb3e3f600bd6ae935609d1f814b2be364a5f9dea549d87373dc9aac60be7c66753af13f10b63f53dbdac52cd1a7"],"fixedEntries":[{"field":"outputs","index":0}],"signingEntries":[],"inputSinces":{}}`,
    );
    console.log(txSkeleton);
    const expectedTx = `{"cellDeps":[{"outPoint":{"txHash":"0xcebb174d6e300e26074aea2f5dbd7f694bb4fe3de52b6dfe205e54f90164510a","index":"0x0"},"depType":"code"},{"outPoint":{"txHash":"0xf8de3bb47d055cdf460d93a2a6e1b05f7432f9777c8c474abf4eec1d4aee5d37","index":"0x0"},"depType":"depGroup"}],"headerDeps":[]}`;
    const actualCkbTx = ckbTxFromTxSkeleton(txSkeleton);
    expect(actualCkbTx).toBe(expectedTx);
  });
});
